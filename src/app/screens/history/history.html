<div class="flex flex-col h-full w-full bg-(--bg-100) overflow-y-auto">
    <div class="p-2 mt-4 md:p-6 lg:p-8 max-w-5xl mx-auto w-full">
        
        <div class="flex justify-between items-center border-b border-(--bg-300) pb-4 sm:pl-5">
            <h1 class="text-2xl sm:text-3xl font-semibold text-(--text-100) flex items-center gap-3">
                <i-lucide [name]="historyIcon" class="w-8 h-8 hidden sm:inline-flex"></i-lucide>
                {{ t().history.title }}
            </h1>
            
            @if (searchService.historyItems().length > 0) {
                <button (click)="clearHistory()" 
                    class="flex items-center gap-2 p-2 text-red-500 hover:scale-105 rounded-lg text-sm sm:text-base cursor-pointer">
                    <i-lucide [name]="trashIcon" class="w-4 h-4 hidden sm:inline-flex"></i-lucide>
                    {{ t().history.clearHistory }}
                </button>
            }
        </div>

        @if (searchService.historyItems().length === 0) {
            <div class="flex flex-col items-center justify-center py-20 text-(--text-300)">
                <i-lucide [name]="historyIcon" class="w-16 h-16 text-(--bg-300)"></i-lucide>
                <p class="text-xl mt-3">{{ t().history.empty }}</p>
            </div>
        } @else {
            <div class="flex flex-wrap justify-between items-end gap-4 mt-6 mb-4 md:pl-6">
                <button (click)="resetFilters()" 
                    [class.opacity-0]="!startDate() && !endDate()"
                    [class.pointer-events-none]="!startDate() && !endDate()"
                    class="text-sm sm:text-base text-(--text-300) hover:text-(--text-200) cursor-pointer hover:scale-105">
                    {{ t().history.clearFilters }}
                </button>

                <div class="flex flex-wrap sm:justify-end justify-center items-center gap-3">
                    <div class="relative flex items-center gap-2 bg-(--bg-200) px-3 py-2 rounded-sm shadow hover:outline hover:outline-(--text-300) cursor-pointer"
                        (click)="focusDateInput(startDateInput)">
                        <i-lucide [name]="calendarIcon" class="w-4 h-4 text-(--text-300)"
                            (click)="openCalendar($event, startDatePicker)"></i-lucide>
                        <span class="text-sm text-(--text-200)">{{ t().history.from }}</span>
                        <input #startDateInput appDateInputMask type="text" [ngModel]="startDate()" (ngModelChange)="onStartDateChange($event)"
                            class="text-(--text-200) text-sm outline-none w-auto cursor-pointer bg-transparent" placeholder="dd/mm/aaaa">
                        <input #startDatePicker type="date" class="absolute inset-0 opacity-0" aria-hidden="true"
                            (change)="onDateSelect($event.target.value, 'start')">
                    </div>

                    <div class="relative flex items-center gap-2 bg-(--bg-200) px-3 py-2 rounded-sm shadow hover:outline hover:outline-(--text-300) cursor-pointer"
                        (click)="focusDateInput(endDateInput)">
                        <i-lucide [name]="calendarIcon" class="w-4 h-4 text-(--text-300)"
                            (click)="openCalendar($event, endDatePicker)"></i-lucide>
                        <span class="text-sm text-(--text-200)">{{ t().history.to }}</span>
                        <input #endDateInput appDateInputMask type="text" [ngModel]="endDate()" (ngModelChange)="onEndDateChange($event)"
                            class="text-(--text-200) text-sm outline-none w-auto cursor-pointer bg-transparent" placeholder="dd/mm/aaaa">
                        <input #endDatePicker type="date" class="absolute inset-0 opacity-0" aria-hidden="true"
                            (change)="onDateSelect($event.target.value, 'end')">
                    </div>

                    <div class="relative hover:outline hover:outline-(--text-300) rounded-sm">
                        <select [ngModel]="order()" (ngModelChange)="order.set($event)"
                            class="appearance-none bg-(--bg-200) text-(--text-200) pl-4 pr-10 py-2 text-sm outline-none cursor-pointer shadow">
                            <option value="newest">{{ t().history.newest }}</option>
                            <option value="oldest">{{ t().history.older }}</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-(--text-200)">
                            <i-lucide [name]="chevronDownIcon" class="h-4 w-4"></i-lucide>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col gap-2">
                @for (item of filteredHistoryItems(); track item.timestamp) {
                    <div (click)="navigateToItem(item)" 
                        class="group flex items-center justify-between sm:px-4 py-2 hover:bg-[#F8F8F8] rounded-sm cursor-pointer border border-transparent hover:border-(--bg-300)">
                        
                        <div class="flex items-center gap-5">
                            <div class="px-2 text-(--text-200) hidden sm:inline-flex">
                                @if (item.type === 'search') {
                                    <i-lucide [name]="searchIcon" class="w-6 h-6"></i-lucide>
                                } @else {
                                    <i-lucide [name]="articleIcon" class="w-6 h-6"></i-lucide>
                                }
                            </div>
                            
                            <div class="flex flex-col">
                                <span class="text-(--text-100) text-lg">{{ item.termOrTitle }}</span>
                                <span class="text-sm text-(--text-300)">
                                    {{ item.type === 'search' ? 'Busca realizada' : 'Artigo visualizado' }}
                                </span>
                            </div>
                        </div>

                        <div class="flex items-center sm:gap-4">
                            <span class="text-sm text-(--text-300) whitespace-nowrap">
                                {{ formatDate(item.timestamp) }}
                            </span>
                            
                            <button (click)="removeSingleItem(item, $event)" 
                                class="flex sm:group-hover:flex p-1 text-red-500 cursor-pointer hover:scale-105" 
                                title="Remover item">
                                <i-lucide [name]="trashIcon" class="w-5 h-5"></i-lucide>
                            </button>
                        </div>
                    </div>
                }
                @if (filteredHistoryItems().length === 0) {
                    <p class="text-center text-(--text-300) py-20">{{ t().history.noItemsFound }}</p>
                }
            </div>
        }
    </div>
</div>
